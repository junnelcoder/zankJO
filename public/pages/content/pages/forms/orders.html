<!DOCTYPE html>
<html lang="en">

<head>
  <!-- Required meta tags -->
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <title>Zank POS</title>
  <!-- base:css -->
  <link rel="stylesheet" href="../../../../css/vendors/mdi/css/materialdesignicons.min.css">
  <link rel="stylesheet" href="../../../../css/vendors/css/vendor.bundle.base.css">
  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
  <style>
    .modal-backdrop {
  z-index: 1040 !important; /* Adjust z-index to ensure it's above other elements */
}

.modal.fade.show {
  display: flex !important;
  align-items: center;
  justify-content: center;
}

.modal {
  overflow: hidden;
}
  </style>
  <script src="../../../../css/js/local.js"></script>
  <!-- endinject -->
  <!-- plugin css for this page -->
  <link rel="stylesheet" href="../../../../css/vendors/datatables.net-bs4/dataTables.bootstrap4.css">
  <!-- End plugin css for this page -->
  <!-- inject:css -->
  <link rel="stylesheet" href="../../../../css/css/vertical-layout-light/style.css">
  <!-- endinject -->
  <link rel="shortcut icon" href="../../../../css/images/favicon.png" />
</head>

<body class="sidebar-fixed " >
  <div class="container-scroller slide-in-left">
    <!-- partial:../../partials/_navbar.html -->
    <!-- partial -->
    <div class="container-fluid page-body-wrapper">
      <!-- partial:../../partials/_settings-panel.html -->
      
      
      <!-- partial -->
      <!-- partial:../../partials/_sidebar.html -->

      <div id="sidebar-container"></div>
      <div id="header-container"></div>
  <script src="../../../../css/js/sidebar.js"></script>

      <!-- partial -->
      <div class="main-panel">          
        <div class="content-wrapper">
          <div class="row">
            <div class="col-12">
              <div class="card">
                <div class="card-body">
                  <h4 class="card-title">Job Ordering Listing</h4>
                  <div class="row grid-margin">
                    <div class="col-12">
                      <br>
                      <div class="date-picker-container1">
                        <label for="end_date">Technical*</label>
                        <select class="form-control" id="technical" name="technical"></select>
                    </div>
                      <div class="date-picker-container">
                        <input type="date" id="start_date" class="white" name="start_date" required>
                        <label for="start_date">Start Date</label>
                      </div>
                      <div class="date-picker-container">
                        <input type="date" id="end_date" class="white" name="end_date" required>
                        <label for="end_date">End Date</label>
                      </div>
                      <div class="button-container">
                        <button id="filter_button"><span>Filter</span></button>
                        <button id="reset_button"><span>Reset</span></button>
                      </div>
                    </div>
                    <div class="col-12">
                      <div class="button-container2">
                        <a href="job_ordering.html" style="text-decoration: none;"><button id="add_button"><i class="mdi mdi-plus-circle add"></i><span>Add</span></i></button></a>
                      </div>
                    </div>
                  </div>
                  
                 
                  
                  <div class="row">
                    
                    <div class="col-12">
                      <div class="table-responsive">
                        <table id="order-listing" class="table">
                          <thead>
                              <tr class="bg-primary text-white">
                                  <th class="widen">Job Order No.</th>
                                  <th id="custom-sort-th" class="vanish">Date</th>
                                  <th class="widen">Customer</th>
                                  <th id="custom-sort-th" class="vanish">Address</th>
                                  <th id="custom-sort-th" class="vanish">Technical</th>
                                  <th id="custom-sort-th" class="vanish">Month No.</th>
                                  <th id="custom-sort-th" class="vanish">Week No.</th>
                                  <th id="custom-sort-th" class="vanish">Status</th>
                                  <th id="custom-sort-th" class="move2">Actions</th>
                              </tr>
                          </thead>
                          <tbody id="jobOrderListBody">
                              <!-- Job order list rows will be dynamically inserted here -->
                          </tbody>
                      </table>
                      
                      <div class="row grid-margin">
                          <!-- Additional content if needed -->
                      </div>
                      
                      </table>
                      </div>
                    </div>
                    

                    <!-- Modal Markup -->
<div class="modal fade" id="jobOrderModal"   >
  <div class="modal-dialog " >
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" >Job Order Details</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
        </button>
      </div>
      <div class="modal-body">
        <div class="row">
          <div class="col-md-6">
            <p><strong>ID:</strong> <span id="jobOrderId"></span></p>
            <p><strong>Date:</strong> <span id="jobOrderDate"></span></p>
            <p><strong>Contact Person:</strong> <span id="jobOrderContactPerson"></span></p>
            <p><strong>Transport for Money:</strong> <span id="jobOrderTransport"></span></p>
            <!-- Add more details here as needed -->
          </div>
          <div class="col-md-6">
            <p><strong>Remarks:</strong> <span id="jobOrderRemarks"></span></p>
            <p><strong>Delivery Remarks:</strong> <span id="jobOrderDeliveryRemarks"></span></p>
            <p><strong>Status:</strong> <span id="jobOrderStatus"></span></p>
            <!-- Add more details here as needed -->
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        <!-- content-wrapper ends -->
        <!-- partial:../../partials/_footer.html -->
        <footer class="footer">
          <div class="d-sm-flex justify-content-center justify-content-sm-between">
            <span class="text-muted text-center text-sm-left d-block d-sm-inline-block">Zank <a href="" target="_blank" class="text-muted"></a></span>
            <span class="float-none float-sm-right d-block mt-1 mt-sm-0 text-center"><i class="mdi mdi-heart-outline text-primary"></i></span>
          </div>
        </footer>
        <!-- partial -->
      </div>
      <script>var jobOrderIDsArray = [];</script>
      <script>
        // Fetch data from the server endpoint
        fetch('/get/technical')
            .then(response => response.json())
            .then(data => {
                // Populate the dropdown with fetched data
                const dropdown = document.getElementById('technical');
    
                // Create an "ALL" option
                const allOption = document.createElement('option');
                allOption.value = 'ALL'; // Set the value for the option
                allOption.textContent = 'ALL*';
                allOption.style.fontStyle = 'italic';  // Set the font style to italic
                dropdown.appendChild(allOption);
    
                // Add fetched data to the dropdown
                data.forEach(entry => {
                    const { id, full_name } = entry;
    
                    const option = document.createElement('option');
                    option.value = id; // Set the value to the employee ID
                    option.textContent = full_name; 
                    option.style.fontStyle = 'italic';// Set the display text to the employee name
                    dropdown.appendChild(option);
                });
    
                // Add event listener to handle selection
                dropdown.addEventListener('change', function () {
                    const selectedTechnicalId = this.value;
                    console.log('Selected Technical ID:', selectedTechnicalId);
                });
            })
            .catch(error => console.error('Error fetching data:', error));
    </script>
    
    
    
      
    <!-- Add this script to the end of the HTML file -->
    <script>
      document.addEventListener('DOMContentLoaded', function () {
          // Initialize the DataTable
          let dataTable = $('#order-listing').DataTable({
    "order": [[0, "asc"]],
    "paging": true,
    "searching": true,
    "lengthMenu": [5, 10, 15],
    "iDisplayLength": 5, // Initial number of entries to show
    "columnDefs": [
        { "targets": [ 1,3, 4, 5, 6, 7], "className": "vanish" } // Apply 'vanish' class to specified columns
    ]
});

  
          // Function to fetch and populate the job order list data
          const populateJobOrderList = () => {
              console.log('Populating job order list...');
  
              const selectedTechnicalId = technicalDropdown.value;
              const startDate = startDateInput.value;
              const endDate = endDateInput.value;
  
              console.log('Selected Technical ID:', selectedTechnicalId);
              console.log('Start Date:', startDate);
              console.log('End Date:', endDate);
  
              axios.get(`http://${location.host}/jobOrderList?technical=${selectedTechnicalId}&start_date=${startDate}&end_date=${endDate}`)
                  .then(response => {
                      // Clear existing rows in the table body
                      dataTable.clear().draw();
  
                      // Check if data is available in the response
                      if (response.data.length === 0) {
                        const noDataMessageRow = document.createElement('tr');
               
                jobOrderListBody.appendChild(noDataMessageRow);
                      } else {
                          // Iterate over the received data and add rows to the DataTable
                          response.data.forEach(joborders => {
                              const formattedDate = new Date(joborders.date).toLocaleDateString('en-US'); // Format date
                              dataTable.row.add([
                                  joborders.joborder_id,
                                  formattedDate,
                                  joborders.customer_name,
                                  joborders.customer_address,
                                  joborders.technical,
                                  joborders.Month,
                                  joborders.WeekNo,
                                  joborders.status,
                                  `<form id="myForm_${joborders.joborder_id}">
                                        <input type="text" style="display: none;" name="JobOrderID" id="JobOrderID_${joborders.joborder_id}" value="${joborders.joborder_id}">
                                        
                                        <button class="btn btn-outline-success btn-icon-text" onclick="window.print()">
                                            <i class="mdi mdi-printer btn-icon-prepend"></i>
                                            <span class="button-label">Print</span> <!-- Label for Print button -->
                                        </button>
                                        <button class="btn btn-outline-danger btn-icon-text" onclick="window.print()">
                                            <i class="mdi mdi-delete btn-icon-prepend"></i>
                                            <span class="button-label">Delete</span> <!-- Label for Delete button -->
                                        </button>
                                    </form>`
                              ]).draw();
                          });
                      }
                  })
                  .catch(error => {
                      console.error('Error fetching job order list:', error);
                  });
          };
  
          const filterButton = document.getElementById('filter_button');
          const resetButton = document.getElementById('reset_button');
          const technicalDropdown = document.getElementById('technical');
          const startDateInput = document.getElementById('start_date');
          const endDateInput = document.getElementById('end_date');
  
          // Attach event listener to the filter button
          filterButton.addEventListener('click', function () {
              console.log('Filter button clicked');
              populateJobOrderList();
          });
  
          // Attach event listener to the reset button
          resetButton.addEventListener('click', function () {
              technicalDropdown.value = 'ALL';
              startDateInput.value = '';
              endDateInput.value = '';
  
              console.log('Reset button clicked');
              // Trigger filter button click event to reset the table
              filterButton.click();
          });
  
          // Populate the job order list when the page loads
          populateJobOrderList();
      });
  
  </script>

    
    
    
    
<script>
  document.addEventListener('DOMContentLoaded', function () {
    // Attach double click event listener to table rows
    $('#order-listing tbody').on('dblclick', 'tr', function () {
      const jobOrderId = $(this).find('td:first').text(); // Extract job order ID from the first column of the clicked row
      
      // Fetch job order details for the clicked job order ID
      axios.get(`/jobOrderDetails/${jobOrderId}`)
        .then(response => {
          const jobOrderDetails = response.data;
          populateModal(jobOrderDetails); // Populate the modal with job order details
          $('#jobOrderModal').modal('show'); // Show the modal
        })
        .catch(error => {
          console.error('Error fetching job order details:', error);
        });
    });
  });

  // Function to populate modal with job order details
  function populateModal(jobOrderDetails) {
                        // Update modal content with job order details
                        document.getElementById('jobOrderId').textContent = jobOrderDetails.joborder_id;
                        document.getElementById('jobOrderDate').textContent = new Date(jobOrderDetails.date).toLocaleDateString('en-US');
                        document.getElementById('jobOrderContactPerson').textContent = jobOrderDetails.contactPerson;
                        document.getElementById('jobOrderTransport').textContent = jobOrderDetails.transportForMoney;
                        document.getElementById('jobOrderRemarks').textContent = jobOrderDetails.remarks;
                        document.getElementById('jobOrderDeliveryRemarks').textContent = jobOrderDetails.deliveryRemarks;
                        document.getElementById('jobOrderStatus').textContent = jobOrderDetails.status;
                        // Update other details as needed
                      }
</script>
    
    
    
    
    
    
      <!-- main-panel ends -->
    </div>
    <!-- page-body-wrapper ends -->
  </div>
  <!-- container-scroller -->
  <!-- base:js -->
  
  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>

  <script src="../../../../css/vendors/js/vendor.bundle.base.js"></script>
  <!-- endinject -->
  <!-- inject:js -->
  <script src="../../../../css/js/off-canvas.js"></script>
  <script src="../../../../css/js/hoverable-collapse.js"></script>
  <script src="../../../../css/js/template.js"></script>
  <script src="../../../../css/js/settings.js"></script>
  <script src="../../../../css/js/todolist.js"></script>
  <!-- endinject -->
  <!-- plugin js for this page -->
  <script src="../../../../css/vendors/datatables.net/jquery.dataTables.js"></script>
  <script src="../../../../css/vendors/datatables.net-bs4/dataTables.bootstrap4.js"></script>
  <!-- End plugin js for this page -->
  <!-- Custom js for this page-->

  <!-- End custom js for this page-->
</body>
<!-- End custom js for this page-->

</html>
